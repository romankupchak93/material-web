{"version":3,"file":"events_test.js","sourceRoot":"","sources":["events_test.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// import 'jasmine'; (google3-only)\n\nimport {dispatchActivationClick, isActivationClick, redispatchEvent} from './events.js';\n\ndescribe('events', () => {\n  let instance: HTMLDivElement;\n\n  beforeEach(() => {\n    instance = document.createElement('div');\n    instance.attachShadow({mode: 'open'});\n    // To have event.target set correctly, the EventTarget instance must be\n    // attached to the DOM.\n    document.body.appendChild(instance);\n  });\n\n  afterEach(() => {\n    document.body.removeChild(instance);\n  });\n\n  describe('redispatchEvent()', () => {\n    it('should re-dispatch events', () => {\n      const event = new Event('foo', {composed: false, bubbles: true});\n      const fooHandler = jasmine.createSpy('fooHandler');\n      instance.addEventListener('foo', fooHandler);\n      redispatchEvent(instance, event);\n\n      expect(fooHandler).toHaveBeenCalled();\n      const redispatchedEvent = fooHandler.calls.first().args[0] as Event;\n      expect(redispatchedEvent)\n          .withContext('redispatched event should be a new instance')\n          .not.toBe(event);\n      expect(redispatchedEvent.target)\n          .withContext(\n              'target should be the instance that redispatched the event')\n          .toBe(instance);\n      expect(redispatchedEvent.type)\n          .withContext('should be the same event type')\n          .toBe(event.type);\n      expect(redispatchedEvent.composed)\n          .withContext('should not be composed')\n          .toBeFalse();\n      expect(redispatchedEvent.bubbles)\n          .withContext('should keep other flags set to true')\n          .toBeTrue();\n    });\n\n    it('should not dispatch multiple events if bubbling and composed', () => {\n      const event = new Event('foo', {composed: true, bubbles: true});\n      const fooHandler = jasmine.createSpy('fooHandler');\n      instance.addEventListener('foo', fooHandler);\n      redispatchEvent(instance, event);\n\n      expect(fooHandler).toHaveBeenCalledTimes(1);\n    });\n\n    it('should not dispatch multiple events if bubbling in light DOM', () => {\n      const lightDomInstance = document.createElement('div');\n      try {\n        document.body.appendChild(lightDomInstance);\n        const event = new Event('foo', {composed: true, bubbles: true});\n        const fooHandler = jasmine.createSpy('fooHandler');\n        instance.addEventListener('foo', fooHandler);\n        redispatchEvent(instance, event);\n\n        expect(fooHandler).toHaveBeenCalledTimes(1);\n      } finally {\n        document.body.removeChild(lightDomInstance);\n      }\n    });\n\n    it('should preventDefault() on the original event if canceled', () => {\n      const event = new Event('foo', {cancelable: true});\n      const fooHandler =\n          jasmine.createSpy('fooHandler').and.callFake((event: Event) => {\n            event.preventDefault();\n          });\n      instance.addEventListener('foo', fooHandler);\n      const result = redispatchEvent(instance, event);\n      expect(result)\n          .withContext('should return false since event was canceled')\n          .toBeFalse();\n      expect(fooHandler).toHaveBeenCalled();\n      const redispatchedEvent = fooHandler.calls.first().args[0] as Event;\n      expect(redispatchedEvent.defaultPrevented)\n          .withContext('redispatched event should be canceled by handler')\n          .toBeTrue();\n      expect(event.defaultPrevented)\n          .withContext('original event should be canceled')\n          .toBeTrue();\n    });\n\n    it('should preserve event instance types', () => {\n      const event = new CustomEvent('foo', {detail: 'bar'});\n      const fooHandler = jasmine.createSpy('fooHandler');\n      instance.addEventListener('foo', fooHandler);\n      redispatchEvent(instance, event);\n\n      expect(fooHandler).toHaveBeenCalled();\n      const redispatchedEvent = fooHandler.calls.first().args[0] as CustomEvent;\n      expect(redispatchedEvent)\n          .withContext('should create the same instance type')\n          .toBeInstanceOf(CustomEvent);\n      expect(redispatchedEvent.detail)\n          .withContext('should copy event type-specific properties')\n          .toBe('bar');\n    });\n  });\n\n  describe('isActivationClick()', () => {\n    it('should return true only if the event originated from target', () => {\n      const listener = jasmine.createSpy('listener', isActivationClick);\n      listener.and.callThrough();\n      instance.addEventListener('click', listener);\n      instance.dispatchEvent(\n          new MouseEvent('click', {bubbles: true, composed: true}));\n      expect(listener).toHaveBeenCalledTimes(1);\n      expect(listener.calls.mostRecent().returnValue).toBe(true);\n      const innerEl = document.createElement('div');\n      instance.shadowRoot!.append(innerEl);\n\n      innerEl.dispatchEvent(\n          new MouseEvent('click', {bubbles: true, composed: true}));\n      expect(listener).toHaveBeenCalledTimes(2);\n      expect(listener.calls.mostRecent().returnValue).toBe(false);\n    });\n  });\n\n  describe('dispatchActivationClick()', () => {\n    it('dispatches an event', () => {\n      const innerEl = document.createElement('div');\n      instance.shadowRoot!.append(innerEl);\n      const listener = jasmine.createSpy('listener');\n      innerEl.addEventListener('click', listener);\n      dispatchActivationClick(innerEl);\n      expect(listener).toHaveBeenCalledTimes(1);\n      dispatchActivationClick(innerEl);\n      expect(listener).toHaveBeenCalledTimes(2);\n    });\n\n    it('dispatches an event that cannot be heard outside dispatching scope',\n       () => {\n         const innerEl = document.createElement('div');\n         instance.shadowRoot!.append(innerEl);\n         const listener = jasmine.createSpy('listener');\n         instance.addEventListener('click', listener);\n         dispatchActivationClick(innerEl);\n         expect(listener).toHaveBeenCalledTimes(0);\n       });\n  });\n});"]}