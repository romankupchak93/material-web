{"version":3,"file":"form-controller_test.js","sourceRoot":"","sources":["form-controller_test.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// import 'jasmine'; (google3-only)\n\nimport {html, LitElement, TemplateResult} from 'lit';\nimport {customElement, property, query} from 'lit/decorators.js';\n\nimport {Environment} from '../testing/environment.js';\nimport {Harness} from '../testing/harness.js';\n\nimport {dispatchActivationClick, isActivationClick} from './events.js';\nimport {FormController, FormElement, getFormValue} from './form-controller.js';\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'my-form-element': MyFormElement;\n    'my-form-data-element': MyFormDataElement;\n    'my-checked-form-element': MyCheckedFormElement;\n    'my-checked-form-associated-element': MyCheckedFormAssociatedElement;\n  }\n}\n\n@customElement('my-form-element')\nclass MyFormElement extends LitElement implements FormElement {\n  get form() {\n    return this.closest('form');\n  }\n  @property({type: Boolean}) disabled = false;\n  @property() name = '';\n  @property() value = '';\n  [getFormValue](): string|null|FormData {\n    return this.value ? this.value : null;\n  }\n\n  constructor() {\n    super();\n    this.addController(new FormController(this));\n  }\n}\n\n@customElement('my-form-data-element')\nclass MyFormDataElement extends MyFormElement {\n  override[getFormValue]() {\n    const data = new FormData();\n    data.append('element-value', this.value);\n    data.append('element-foo', 'foo');\n    return data;\n  }\n}\n\n@customElement('my-checked-form-element')\nclass MyCheckedFormElement extends MyFormElement {\n  @property({type: Boolean}) checked = false;\n\n  @query('#checked') checkedEl!: HTMLDivElement;\n\n  constructor() {\n    super();\n    this.setupActivationClickHandler();\n  }\n\n  setupActivationClickHandler() {\n    this.addEventListener('click', (event: MouseEvent) => {\n      if (!isActivationClick(event)) {\n        return;\n      }\n      this.checkedEl.focus();\n      dispatchActivationClick(this.checkedEl);\n    });\n  }\n\n  // Note, due to the following Firefox issue, it's important that the\n  // element contain native \"interactive content\" like a button or input,\n  // see https://bugzilla.mozilla.org/show_bug.cgi?id=1804576.\n  //\n  override render() {\n    return html`<button id=\"checked\" @click=${\n        () => this.checked = !this.checked}>\n      ${this.checked}\n    </button>`;\n  }\n\n  override focus() {\n    this.checkedEl.focus();\n  }\n}\n\n@customElement('my-checked-form-associated-element')\nclass MyCheckedFormAssociatedElement extends MyCheckedFormElement {\n  static formAssociated = true;\n}\n\nclass CheckedFormElementHarness extends Harness<MyCheckedFormElement> {\n  protected override async getInteractiveElement() {\n    await this.element.updateComplete;\n    return this.element.checkedEl;\n  }\n}\n\ndescribe('FormController', () => {\n  const env = new Environment();\n\n  async function setupTest(template: TemplateResult) {\n    const root = env.render(html`\n      <form>${template}</form>\n    `);\n\n    await env.waitForStability();\n    const element =\n        root.querySelector('form')!.firstElementChild! as HTMLElement;\n    return new Harness(element);\n  }\n\n  it('should add element\\'s name/value pair to the form', async () => {\n    const harness = await setupTest(html`\n      <my-form-element name=\"element\" value=\"foo\"></my-form-element>\n    `);\n    const data = await harness.submitForm();\n    expect(data.has('element'))\n        .withContext('should add name to data')\n        .toBeTrue();\n    expect(data.get('element'))\n        .withContext('should add value to data')\n        .toBe('foo');\n  });\n\n  it('should add form associated element\\'s name/value pair to the form',\n     async () => {\n       const harness = await setupTest(\n           html`\n        <my-checked-form-associated-element name=\"element\" value=\"foo\">\n        </my-checked-form-associated-element>`);\n\n       const data = await harness.submitForm();\n       expect(data.has('element'))\n           .withContext('should add name to data')\n           .toBeTrue();\n       expect(data.get('element'))\n           .withContext('should add value to data')\n           .toBe('foo');\n     });\n\n  it('should not add data when disconnected', async () => {\n    const harness = await setupTest(html`\n      <my-form-element name=\"element\" value=\"foo\"></my-form-element>\n    `);\n\n    const form = harness.element.form!;\n    harness.element.remove();\n    expect(harness.element.form).toBeNull();\n    const data = await harness.submitForm(form);\n    expect(data.has('element'))\n        .withContext('should not add disconnected element to data')\n        .toBeFalse();\n  });\n\n  it('should not add data when element is disabled', async () => {\n    const harness = await setupTest(html`\n      <my-form-element name=\"element\" value=\"foo\" disabled></my-form-element>\n    `);\n\n    const data = await harness.submitForm();\n    expect(data.has('element'))\n        .withContext('should not add disabled element to data')\n        .toBeFalse();\n  });\n\n  it('should not add data when value is null', async () => {\n    const harness = await setupTest(html`\n      <my-form-element name=\"element\"></my-form-element>\n    `);\n\n    const data = await harness.submitForm();\n    expect(data.has('element'))\n        .withContext('should not add null value to data')\n        .toBeFalse();\n  });\n\n  it('should add all entries if element returns FormData', async () => {\n    const harness = await setupTest(\n        html`\n      <my-form-data-element value=\"foo\"></my-form-data-element>\n    `);\n\n    const data = await harness.submitForm();\n    expect(data.has('element-value'))\n        .withContext('should add element-value data')\n        .toBe(true);\n    expect(data.has('element-foo'))\n        .withContext('should add element-value data')\n        .toBe(true);\n    expect(data.get('element-value'))\n        .withContext('element-value should match data value')\n        .toBe('foo');\n    expect(data.get('element-foo'))\n        .withContext('element-foo should match \"foo\"')\n        .toBe('foo');\n  });\n\n  describe('label activation', () => {\n    const setupLabelTest = async (\n        template: TemplateResult,\n        harnessTag = 'my-checked-form-associated-element') => {\n      const root = env.render(html`\n        <form>${template}</form>\n      `);\n      await env.waitForStability();\n      const label = new Harness(root.querySelector<HTMLLabelElement>('label')!);\n      const face = new CheckedFormElementHarness(\n          root.querySelector<MyCheckedFormElement>(harnessTag)!);\n      return {label, face};\n    };\n\n    it('should activate via click event', async () => {\n      const {face} = await setupLabelTest(html`\n        <label>\n          <my-checked-form-associated-element value=\"foo\">\n          </my-checked-form-associated-element>\n        </label>\n      `);\n      expect(face.element.checked).toBeFalse();\n      await face.clickWithMouse();\n      expect(face.element.checked).toBeTrue();\n      await face.clickWithMouse();\n      expect(face.element.checked).toBeFalse();\n    });\n\n    it('should activate via click method', async () => {\n      const {face} = await setupLabelTest(html`\n        <label>\n          <my-checked-form-associated-element value=\"foo\">\n          </my-checked-form-associated-element>\n        </label>\n      `);\n      expect(face.element.checked).toBeFalse();\n      face.element.click();\n      await env.waitForStability();\n      expect(face.element.checked).toBeTrue();\n      face.element.click();\n      await env.waitForStability();\n      expect(face.element.checked).toBeFalse();\n    });\n\n    it('should activate form associated elements via surrounding label',\n       async () => {\n         const {label, face} = await setupLabelTest(html`\n          <label>\n            label\n            <my-checked-form-associated-element value=\"foo\">\n            </my-checked-form-associated-element>\n          </label>`);\n         expect(face.element.checked).toBeFalse();\n         await face.clickWithMouse();\n         expect(face.element.checked).toBeTrue();\n         await label.clickWithMouse();\n         expect(face.element.checked).toBeFalse();\n         await label.clickWithMouse();\n         expect(face.element.checked).toBeTrue();\n       });\n\n    it('should not generate extra clicks when activated', async () => {\n      const {label, face} = await setupLabelTest(html`\n        <label>\n          <my-checked-form-associated-element value=\"foo\">\n          </my-checked-form-associated-element>\n        </label>`);\n      expect(face.element.checked).toBeFalse();\n      const clickListener = jasmine.createSpy('clickListener');\n      face.element.addEventListener('click', clickListener);\n      await face.clickWithMouse();\n      expect(clickListener).toHaveBeenCalledTimes(1);\n      face.element.click();\n      await env.waitForStability();\n      expect(clickListener).toHaveBeenCalledTimes(2);\n      await label.clickWithMouse();\n      expect(clickListener).toHaveBeenCalledTimes(3);\n    });\n\n    it('should activate form associated elements via label with matching `for`',\n       async () => {\n         const {label, face} = await setupLabelTest(html`\n          <label for=\"a\">a</label>\n          <my-checked-form-associated-element id=\"a\" value=\"foo\">\n          </my-checked-form-associated-element>`);\n         expect(face.element.checked).toBeFalse();\n         await face.clickWithMouse();\n         expect(face.element.checked).toBeTrue();\n         await label.clickWithMouse();\n         expect(face.element.checked).toBeFalse();\n         await label.clickWithMouse();\n         expect(face.element.checked).toBeTrue();\n\n         // Disconnect `for` and check that face is not activated.\n         label.element.setAttribute('for', '');\n         await label.clickWithMouse();\n         expect(face.element.checked).toBeTrue();\n       });\n\n    it('should *not* activate disabled form associated elements via label',\n       async () => {\n         const {label, face} = await setupLabelTest(html`\n          <label>\n            label\n            <my-checked-form-associated-element disabled value=\"foo\">\n            </my-checked-form-associated-element>\n          </label>`);\n         expect(face.element.checked).toBeFalse();\n         await label.clickWithMouse();\n         expect(face.element.checked).toBeFalse();\n       });\n\n    it('should *not* activate non-form associated elements via label',\n       async () => {\n         const {label, face} = await setupLabelTest(\n             html`\n          <label>\n            label\n            <my-checked-form-element value=\"foo\">\n            </my-checked-form-element>\n          </label>`,\n             `my-checked-form-element`);\n         expect(face.element.checked).toBeFalse();\n         await face.clickWithMouse();\n         expect(face.element.checked).toBeTrue();\n         await label.clickWithMouse();\n         expect(face.element.checked).toBeTrue();\n       });\n  });\n});"]}